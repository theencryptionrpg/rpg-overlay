<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            background: transparent;
            margin: 0;
            overflow: hidden;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 95vh;
            gap: 20px;
            padding: 20px;
        }
        .player {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }
        .nome {
            color: cyan;
            font-size: 70px;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 25px cyan;
        }
        .numeros {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .numeros img {
            height: 105px;
        }
    </style>
</head>
<body>
    <div class="container" id="players-container">
        Carregando...
    </div>

    <script>
        const spreadsheetId = '1KVc7ozrZoeAtViL8byF8wIUAoL7co4x-iqO-qRGLY2M';
        const apiKey = 'AIzaSyCGm86Oo_M1VyR60TILWg6j4jvCze7E0KU';

        const prefixoVida = '';
        const prefixoEnergia = 'e';

        let estadoAnterior = [];

        function criarNumeros(atual, maximo, prefixo) {
            const div = document.createElement('div');
            div.className = 'numeros';

            // Atual
            (atual || 0).toString().split('').forEach(d => {
                const img = document.createElement('img');
                img.src = `./${d.toLowerCase()}${prefixo}.png`;
                div.appendChild(img);
            });

            // Slash
            const slash = document.createElement('img');
            slash.src = `./slash${prefixo}.png`;
            div.appendChild(slash);

            // Máximo
            (maximo || 0).toString().split('').forEach(d => {
                const img = document.createElement('img');
                img.src = `./${d.toLowerCase()}${prefixo}.png`;
                div.appendChild(img);
            });

            return div;
        }

        function criarPlayer(row) {
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player';

            const nomeDiv = document.createElement('div');
            nomeDiv.className = 'nome';
            nomeDiv.textContent = row[0].trim() || 'Jogador';
            playerDiv.appendChild(nomeDiv);

            // Vida: atual (C = row[2]), max (B = row[1])
            playerDiv.appendChild(criarNumeros(Number(row[2] || 0), Number(row[1] || 0), prefixoVida));

            // Energia: atual (E = row[4]), max (D = row[3])
            playerDiv.appendChild(criarNumeros(Number(row[4] || 0), Number(row[3] || 0), prefixoEnergia));

            return playerDiv;
        }

        function atualizar() {
            fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/A2:E?key=${apiKey}`)
                .then(res => res.json())
                .then(data => {
                    if (!data.values || data.values.length === 0) {
                        document.getElementById('players-container').innerHTML = 'Nenhum jogador encontrado';
                        return;
                    }

                    const novoEstado = data.values
                        .filter(row => row[0] && row[0].trim() !== '' && row[1] !== undefined && row[2] !== undefined)  // Linhas válidas
                        .map(row => ({
                            nome: row[0].trim(),
                            vidaAtual: Number(row[2] || 0),
                            vidaMax: Number(row[1] || 0),
                            energiaAtual: Number(row[4] || 0),
                            energiaMax: Number(row[3] || 0)
                        }));

                    if (JSON.stringify(novoEstado) !== JSON.stringify(estadoAnterior)) {
                        const container = document.getElementById('players-container');
                        container.innerHTML = '';

                        data.values.forEach(row => {
                            if (row[0] && row[0].trim() !== '' && row[1] !== undefined && row[2] !== undefined) {
                                container.appendChild(criarPlayer(row));
                            }
                        });

                        estadoAnterior = novoEstado;
                    }
                })
                .catch(err => {
                    document.getElementById('players-container').innerHTML = 'Erro ao carregar dados';
                });
        }

        atualizar();
        setInterval(atualizar, 3000);
    </script>
</body>
</html>
